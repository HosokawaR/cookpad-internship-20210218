# 発展課題

以下の手順でプルリクエストを作成してください。
GitHub の操作については https://docs.github.com/ja/free-pro-team@latest/github/collaborating-with-issues-and-pull-requests/creating-a-pull-request を参照してください。

1. `advanced` ブランチに switch する
2. 後述の発展課題を解く（必要に応じてテストも書く）
3. fork したリポジトリに push する
4. プルリクエスト作成画面で `advanced` ブランチ を base ブランチに設定する
5. テンプレートに従って項目を埋める
6. 差分が意図通りか確認し、問題があったら修正する
7. 作成ボタンを押してプルリクエストを作成する
8. ステータスチェックが通るか確認し、通らなければ問題を修正して通るようにする

ステータスチェックでは、[GitHub Actions](https://github.co.jp/features/actions) により以下を自動で行います。

- テストがすべて通るかの確認
- [クックパッド Ruby スタイルガイド](https://github.com/cookpad/styleguide/blob/master/ruby.ja.md) 違反の指摘

## アルゴリズム

### 1-1. ボルダルール

ハンズオンで実装したのは単純多数決だが、ほかの投票方式もある。
その1つが[ボルダルール](https://ja.wikipedia.org/wiki/%E3%83%9C%E3%83%AB%E3%83%80%E5%BE%97%E7%82%B9)である。
ボルダルールでは、投票者は候補に順位をつける。
たとえば、Alice, Bob, Carol が候補の投票で、3人の投票者が次のような順位をつけたとする。

順位 | 投票者1 | 投票者2 | 投票者3
-- | -- | -- | --
1 | Alice | Carol | Carol 
2 | Bob | Alice | Alice
3 | Carol | Bob | Bob

このとき、1位が3点、2位が2点、3位が1点を獲得するのがボルダルールである。
上記の例では、Alice が 3+2+2=7 点、Bob が 2+1+1=4 点、Carol が 1+3+3=7 点で Alice と Carol が同率一位になる。
このように、ボルダルールでは、n人の候補がいるとき、1位の候補がn点、2位の候補がn-1点、……、n位の候補が1点を獲得する。

ボルダルールの投票を実現する `RankedVote` と `BordaPoll` を追加せよ。

### 1-2. コンドルセ基準

コンドルセ基準は、順位付きの票を用いる点でボルダルールと同じである。
しかし、勝者の決め方が異なる。
コンドルセ基準では、ほかのどの候補に対してもペアごとの多数決で勝利するものを勝者とする。
1-1 の表の例では、Alice と Bob のペアで比較したとき、投票者の3人とも Alice の順位を高くつけている。
次に、Alice と Carol のペアで比較したとき、1対2で Carol を高くつけている投票者の方が多い。
よって、Alice はコンドルセ基準の勝者にはならない。
ここで、Carol と Bob のペアで比較すると、2対1で Carol を高くつけている投票者の方が多い。
Carol は Alice と Bob 両方の候補に対してペアごとの多数決で勝利するので、Carol がコンドルセ基準での勝者になる。

1-1 で実装した `RankedVote` を用いて、コンドルセ基準の投票を実現する `CondorcetPoll` を追加せよ。
なお、単純多数決やボルダルールとちがって得点があるわけではないので、投票結果としては勝者だけが分かればよい。

## ウェブアプリの機能実装

### 2-1. 不正対策

ハンズオンで作成した投票アプリでは、同一人物が何度でも投票できたり、別人の名前を騙って投票できたりしてしまう。
完全に防止できなくともよいので、こうした不正ができにくくなるような対策を講じよ。
プルリクエストには、どのような対策を講じたか、なぜそれが不正の対策になるのかを明記すること。

### 2-2. 独自機能の追加

ハンズオンで作成した投票アプリに独自の機能を追加せよ。
また、プルリクエストには、ユーザーがどのようにその機能を使う想定なのか明記すること。
たとえば、ただ「一票で複数の候補に投票できるようにした」や「票にコメントを残せるようにした」というだけでは、ユーザーがそれをどう使うかイメージできない。
しかし、「日程調整にこのアプリを利用するとき、ユーザーが複数の候補日を選択したり、途中参加の補足を入力したりすることを想定して」という前置きがあれば、その機能の使われるイメージがわく。
このように、ただ実装できそうだから実装したというのではなく、事前にユースケースを想定してから機能を追加すること。

## データベース

以下は、データベースの知識を前提としている。

### 3-1. テーブル設計

ハンズオンで作成した投票アプリの投票や票のデータを保存するテーブルを SQL で定義せよ。
データベースは、MySQL・PostgreSQL・SQLite のいずれかを想定し、`db/create_tables.sql` に SQL を書くこと。

### 3-2. 投票アプリのデータの永続化

ハンズオンで作成した投票アプリからグローバル変数 `$polls` を取り除き、代わりにデータベースを用いるようにせよ。
